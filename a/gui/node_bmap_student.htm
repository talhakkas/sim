<script type="text/javascript" src="/public/js/jquery.js"></script> 
<script type="text/javascript" src="/public/js/jquery.tokeninput.js"></script> 
<script type="text/javascript" src="/public/js/jquery.maphilight.min.js"></script>

<script type="text/javascript">
  $(function() {
    $('.map').maphilight({fade: false});
  });
</script>

<script language="JavaScript" type="text/javascript">
// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove = function(from, to) {
		  var rest = this.slice((to || from) + 1 || this.length);
		    this.length = from < 0 ? this.length + from : from;
			  return this.push.apply(this, rest);
};

var BOLGE = [
				<F3:repeat group="{{@SESSION.map}}" key="{{@mid}}" value="{{@m}}">
					"{{@m['name']}}",
				</F3:repeat>
			];

function sec(bolge)
{
	var hidden = document.getElementById('hselected');
	var dict = hidden.value.split(',');
	var anahtar = false;

	bolge = bolge.toString();
	if(hidden.value == "") {
		hidden.value = bolge; 

		var id = parseInt(bolge);
		$("#selected").tokenInput("add", {id: id, name: BOLGE[id]});
		return;
	}
	
	for(var i=0; i<dict.length; i++)
		if(dict[i] == bolge) {
			dict.remove(i);

			var id = parseInt(bolge);
			$("#selected").tokenInput("remove", {name: BOLGE[id]});
			anahtar = true;
		}
	
	if(anahtar == false) {
		dict.push(bolge);

		var id = parseInt(bolge);
		$("#selected").tokenInput("add", {id: id, name: BOLGE[id]});
	}
	
	hidden.value = dict.join(",");
}

function soyle()
{
	var hidden = document.getElementById('selected');
	var dict = hidden.value.split(',');

	var str = "";
	for(var i=0; i<dict.length; i++)
		str = str + BOLGE[dict[i]] + ";";
	
	alert(str);
}	
</script>

<div align="middle">

<map id="bmap" name="bmap">
 <F3:repeat group="{{@SESSION.map}}" key="{{@mid}}" value="{{@m}}">
	<area shape="{{@m['shape']}}" alt="{{@m['name']}}" 	  coords="{{@m['coords']}}" 
		  href="{{@m['href']}}" target="{{@m['target']}}" title="{{@m['name']}}"     onclick="sec('{{@mid}}');" >
 </F3:repeat>
</map>

<form method="post" action="{{@SR}}/show/{{@SESSION.cid}}/{{@SESSION.data['opts']['node_link']}}/0">
	
	<div class="tokeninput">
		<img src="/public/img/body_map.jpg" usemap="#bmap" align="left">

		<p class="answer left" align="left">Tetkik yapmak istediğiniz vücut haritası üzerinde bölgeyi ya tıklayarak ekleyip/kaldırın 
			veya sağdaki girdi alanına girerek yapınız.</p>
		<label class="label">
			<input type="text" name="selected" id="selected">
		</label>
	</div>
	<input type="hidden" name="hselected" id="hselected">

	<br>
	<input type="submit" value="Seçilenleri Söyle" class="button">

    <script type="text/javascript">
      $(document).ready(function() {
          $("#selected").tokenInput([
				<F3:repeat group="{{@SESSION.map}}" key="{{@mid}}" value="{{@m}}">
					{id:{{@mid}}, name:"{{@m['name']}}"},
				</F3:repeat>
			], {
				preventDuplicates: true,
			});
          });
    </script>

</form>
</div>
